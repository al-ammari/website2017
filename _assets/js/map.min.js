var myIp="",myCity="",myCountry="",myCountryName="",myIsp="",myAsn="",myLat="",myLong="",autocompletes={country:[],region:[],city:[],zipCode:[],ISP:[],submitter:[]},init=function(){getMyLocation(),setUpGMaps(),setDefaultMapSettings(),getLayers(),populateLayersContainer(),getPrivacyReport(),0==initMode?(jQuery(".opening.modal").modal("show"),jQuery(".sidebar.vertical.legend").addClass("overlay visible animating")):1==initMode?submitCustomQuery(trIdFilter):2==initMode&&processPostedData(postedData),createASRow("first"),setUpClickHandlers(),_.each(autocompletes,function(a,b){loadAutocompleteData(b)}),autocompletes.nsa=["yes","no"],bindAutocomplete(jQuery('.bs-input[data-constraint="NSA"]'),"nsa"),populateTooltips()},getMyLocation=function(){jQuery("#my-location-status").html("Loading location...");var a={action:"getMyLocation"};jQuery.ajax(url_base+"/application/controller/mygeoip.php",{type:"post",data:a,success:function(a){console.log("getMyLocation data loaded ");var b=jQuery.parseJSON(a);setMyLocationData(b)},error:function(a){console.log("Error! getMyLocation data can't be loaded",a)}})},setMyLocationData=function(a){jQuery("#my-location-status").html(""),myIp=a.myIp,myCity=a.myCity,myCountry=a.myCountry,myCountryName=a.myCountryName,myIsp=a.myIsp,myAsn=a.myAsn,myLat=a.myLat,myLong=a.myLong,resetUserLocQueryOptions(),//!!
buildTrCountQuery("first")},setUpClickHandlers=function(){jQuery("#search-header .qs-last-contributed-btn").click(function(){constructLastContributed()}),jQuery("#search-header .qs-via-nsa-city-btn").click(function(){constructViaNSA()}),jQuery("#search-header .qs-via-boomerangs-btn").click(function(){constructBoomerangs()}),jQuery("#search-header .qs-from-my-isp-btn").click(function(){constructFromMyIsp()}),jQuery("#search-header .qs-from-my-cty-btn").click(function(){constructFromMyCity()}),jQuery("#search-header .qs-from-my-country-btn").click(function(){constructFromMyCountry()}),jQuery("#bs-submit-btn").click(function(){constructBS()}),jQuery("#as-submit-btn").click(function(){constructAS()}),jQuery("#as-clear-btn").click(function(){jQuery(".advanced.input-holder").remove(),createASRow("first")}),jQuery("#myloc-submit-btn").click(function(){submitUserLocObject(),jQuery(".opening.modal").modal("hide")}),jQuery("#myloc-skip-btn").click(function(){jQuery(".opening.modal").modal("hide")}),jQuery("#myloc-contribute-btn").click(function(){jQuery(".opening.modal").modal("hide"),window.location="/contribute.php"}),jQuery("#myloc-reload-btn").click(function(){jQuery("#myloc-reload-btn").removeClass("blue"),buildTrCountQuery("")}),jQuery(".map-settings-button").click(function(){jQuery(".settings.modal").modal("show")}),jQuery("#map-help-btn").click(function(){jQuery(".map-help.modal").modal("show")}),jQuery(".userloc-submitter").change(function(){jQuery("#myloc-reload-btn").addClass("blue")}),jQuery(".userloc-city").change(function(){jQuery("#myloc-reload-btn").addClass("blue")}),jQuery(".user-loc-chkbox").change(function(){jQuery("#myloc-reload-btn").addClass("blue")}),jQuery(".userloc-city .userloc-submitter").focus(function(){jQuery("#myloc-reload-btn").addClass("blue")}),jQuery("#remove-all-trs-btn").click(function(){removeAllTrs()}),jQuery("#add-all-trs-btn").click(function(){addAllTrs()}),jQuery("#cancel-query").click(function(){cancelQuery(),hideLoader()}),jQuery("#filter-results-summary-container").click(function(){jQuery("#filter-results-summary").toggle()}),jQuery("#tr-details-close-btn").click(function(){removeTr(),jQuery(".traceroutes.modal").modal("hide")}),jQuery("#settings-close-btn").click(function(){removeTr(),jQuery(".settings.modal").modal("hide")}),jQuery("#flagging-close-btn").click(function(){removeTr(),jQuery(".flagging.modal").modal("hide")}),jQuery("#carrier-close-btn").click(function(){removeTr(),jQuery(".carrier.modal").modal("hide")}),jQuery("#opening-close-btn").click(function(){removeTr(),jQuery(".opening.modal").modal("hide")}),jQuery("#map-help-close-btn").click(function(){jQuery(".map-help.modal").modal("hide")}),jQuery(".top.menu .item").on("click",function(){jQuery(".active").removeClass("active"),jQuery(this).addClass("active"),jQuery(".tab").hide(),jQuery("#"+jQuery(this).attr("id")+"-container").show()}),jQuery(".as-link").on("click",function(){jQuery(".active").removeClass("active"),jQuery("#as-tab").addClass("active"),jQuery(".tab").hide(),jQuery("#as-tab-container").show()}),jQuery("table").tablesorter({}),jQuery(".ui.rating").rating("disable"),jQuery("#settings-modal").click(function(){jQuery(".settings.modal").modal("show")}),jQuery("#traceroutes-modal").click(function(){jQuery(".traceroutes.modal").modal("show")}),jQuery("#router-modal").click(function(){jQuery(".router.modal").modal("show")}),jQuery("#carrier-modal").click(function(){jQuery(".carrier.modal").modal("show")}),jQuery("#opening-modal").click(function(){jQuery("#opening-modal-div").modal("show"),jQuery(".opening.modal").modal("show")}),jQuery("#flagging-modal").click(function(){jQuery(".flagging.modal").modal("show")}),jQuery("a.from.basic-srch-itm").popup({popup:".from.popup",inline:!0,on:"click"}),jQuery(".basic-srch-itm.via").popup({popup:".via.popup",inline:!0,on:"click"}),jQuery(".basic-srch-itm.to").popup({popup:".to.popup",inline:!0,on:"click"}),jQuery(".ui.sidebar").sidebar({context:jQuery(".map-holder"),dimPage:!1,closable:!1}).sidebar("setting","transition","overlay","toggle").sidebar("attach events",".map-holder .layers-toggle .toggle.button"),jQuery(".ui.accordion").accordion(),jQuery(".toggle.button").state({})},renderTrResultTable=function(a){},showLoader=function(){jQuery("#loader").show()},hideLoader=function(){jQuery("#loader").hide()},cancelQuery=function(){ajaxObj&&4!=ajaxObj.readystate&&(ajaxObj.abort(),console.log("Query submission has been canceled."))},setTableSorters=function(){console.log("Sorting TR Tables"),jQuery("#traceroutes-table").tablesorter({sortList:[[0,2]]})},loadAutocompleteData=function(a){var b={action:"loadAutoCompleteData",field:a,keyword:" "};jQuery.ajax(url_base+"/application/controller/autocomplete.php",{type:"post",data:b,success:function(b){var c=jQuery.parseJSON(b);autocompletes[a]=_.reject(c,_.isNull),bindAutocomplete(jQuery('.bs-input[data-constraint="'+a+'"]'),a),"country"===a&&bindAutocomplete(jQuery(".userloc-country"),a),"city"===a&&bindAutocomplete(jQuery(".userloc-city"),a)},error:function(a){console.error("Autocomplete data can't be loaded",a)}})},bindAutocomplete=function(a,b){autocompletes[b]?jQuery(a).autocomplete({source:autocompletes[b]}):console.log("Cannot bind autocomplete data")},populateTooltips=function(){_.each(tooltips,function(a){jQuery(a.element).attr("title",a.text)})},tooltips=[{element:"#qs-tab",text:"Several predefined searches"},{element:"#bs-tab",text:"Search on basic traceroute parameters: From, Via, and To"},{element:"#as-tab",text:"Multiple options for flexibly composing search queries"},{element:".map-settings-button",text:"Adjust how routes are are mapped. e.g. Keep routes visible when adding others.  Takes effect following the next search"},{element:"#add-all-trs-btn",text:"Display all the routes in the current sample of routes below. To see them overlaid, turn on Multiple routes in Settings"},{element:"#remove-all-trs-btn",text:"Remove all currently displayed routes"},{element:"#carrier-table .carrier",text:"Click on the carrier name to show more details about its rating on each 10 criteria star criteria"},{element:"#carrier-table .star-col",text:"Aggregate star score out of 10 maximum"},{element:"#bs-submit-btn",text:"Initiate search for routes that match all conditions specified in the FROM, VIA and TO boxes"},{element:"#bs-tab-container .from",text:"Specify search conditions for the origin of traceroutes e.g. From> ISP: Bell"},{element:"#bs-tab-container .via",text:"Specify search conditions for intermediate traceroute hops e.g. Via> Country: US"},{element:"#bs-tab-container .to",text:"Specify search conditions for intended destination or termination of traceroute e.g. To> Website: CBC.ca"},{element:".qs-last-contributed-btn",text:"Finds the 20 most recently contributed traceroutes"},{element:".qs-via-nsa-city-btn",text:"Finds all routes that pass through at least one of the 18 US cities strongly suspected of hosting NSA interception facilities. This search takes longer than usual due to the number search items. For more, see Learn/Issues"},{element:".qs-via-boomerangs-btn",text:"Finds all routes that originate in Canada but pass through the US before returning home. For more, see Learn/Issues"},{element:".qs-from-my-isp-btn",text:"Finds all routes that originate with your current ISP"},{element:".qs-from-my-cty-btn",text:"Finds all routes that originate from your current city"},{element:".qs-from-my-country-btn",text:"Finds all routes that originate from your current country"},{element:"#map-allow-multiple",text:"Displaying a route doesn't remove previously displayed routes"},{element:"#map-allow-recenter",text:"Map is recentred according to the most recently displayed route"},{element:"#map-show-hops",text:"Displays dots for routers, colour-coded for ISP"},{element:"#map-show-routers",text:"Displays lines for hops, with same colour as the originating router"},{element:"#map-show-marker-origin",text:"Displays a green marker at location of first router displayed in route"},{element:"#map-exclude-a",text:"Excludes routers assigned the impossible location of latitude=0 and longtitude = 0 (i.e. on the equator in the Atlantic Ocean)"},{element:"#map-exclude-b",text:"Excludes routers assigned the impossible location of the geographic centre of Canada and the US. Generic locations for other countries will be displayed, often in lakes or wilderness areas near the geographic centre"},{element:"#map-exclude-d",text:"Excludes routers for which an ASN (ie carrier) has not been assigned"},{element:"#map-exclude-e",text:"Excludes routers that a user has flagged as inaccurately located, and not yet corrected by IXmaps"},{element:"#filter-results-content .header-results",text:"The total number of traceroutes found that meet the criteria of the latest search"},{element:".traceroutes-results",text:"Listed below are a selection of the traceroutes found. To map them, click on the traceroute number (TR ID)"},{element:"",text:""},{element:"",text:""},{element:"",text:""}];